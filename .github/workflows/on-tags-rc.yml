name: Deploy Release Candidate

on:
  push:
    tags:
      - "v*rc*" # Triggers on tags like v1.0.0rc1, v2.1.0rc2, etc.
  workflow_dispatch:
    inputs:
      reset_database:
        description: "⚠️ DANGER: Reset database (DROP ALL TABLES) before deployment"
        required: false
        type: boolean
        default: false

jobs:
  deploy:
    name: Deploy to RC Environment
    permissions:
      id-token: write # Required for AWS authentication via OIDC
      contents: read
    uses: ./.github/workflows/infra.yml
    with:
      instance_name: audit-production
      web_domain: rc.llm-cp.example.com # TODO: Update with your actual domain
      api_domain: api.rc.llm-cp.example.com # TODO: Update with your actual domain
      environment: prod
      reset_database: ${{ github.event.inputs.reset_database == true && 'true' || 'false' }}
      aurora_min_capacity: "0.5"
      aurora_max_capacity: "4"
      login_position: "CENTER"
    secrets:
      aws_role_arn: ${{ secrets.AWS_ROLE_ARN_PROD }} # Use production AWS account role
